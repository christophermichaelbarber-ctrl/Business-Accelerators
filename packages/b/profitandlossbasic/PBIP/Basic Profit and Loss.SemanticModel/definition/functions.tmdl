/// Creates the P&L Lines
function __Fn_PnL_Sum_Subtotal_and_Blanks =
		(
		    amount: EXPR
		) =>
		VAR accountinscope = ISFILTERED( Account )
		VAR NCLD_filter_context_calculated_table =
		    CALCULATETABLE(
		        Layout,
		        REMOVEFILTERS( Layout ),
		        Layout[Income_Statement_Key] >= MIN( Layout[Subtotal_From] ),
		        Layout[Income_Statement_Key] <= MIN( Layout[Subtotal_To] )
		    )
		VAR step1_lineitem = amount * MAX( Account[Account Type Indicator] )
		VAR step2_subtotal =
		    CALCULATE( amount * MAX( Account[Account Type Indicator] ), NCLD_filter_context_calculated_table )
		VAR step3_addblanks = SWITCH(
		        TRUE( ),
		        accountinscope, BLANK( ),
		        SELECTEDVALUE( Layout[Calculation_type] ) = "Blank", 0
		    )
		VAR step3_add_zero = COALESCE( step1_lineitem, step2_subtotal, step3_addblanks )
		RETURN
		    step3_add_zero
	lineageTag: 26c36bef-557c-49fa-a7a3-5339f214ddef

/// Creates the P&L Lines
function __Fn_PnL_Variance_Highlights = ```
		(
		    amount: EXPR
		) =>
		
		
		var green = "#238823"
		var red = "#D2222D"
		
		VAR NCLD_filter_context_calculated_table =
		    CALCULATETABLE(
		        Layout,
		        REMOVEFILTERS( Layout ),
		        Layout[Income_Statement_Key] >= MIN( Layout[Subtotal_From] ),
		        Layout[Income_Statement_Key] <= MIN( Layout[Subtotal_To] )
		    )
		VAR step1_lineitem = MAX( Account[Account Type Indicator] )
		VAR step2_subtotal =
		    CALCULATE( MAX( Account[Account Type Indicator] ), NCLD_filter_context_calculated_table )
		
		
		VAR indicator= COALESCE( step1_lineitem, step2_subtotal )
		
		var result = 
		
		switch 
			(
			true(),
			amount * indicator > 0, green,
			amount * indicator < 0, red	
			)
		
		
		
		
		RETURN
		    result
		```
	lineageTag: fe42879d-813f-4e8b-af83-465c3a2a94d9

/// Creates the P&L Lines
function __Fn_PnL_ShowScenario =
		(
		    amount: EXPR
		) =>
		
		IF(ISFILTERED(Ledger),BLANK(), __Fn_PnL_Sum_Subtotal_and_Blanks(amount))
	lineageTag: 62fed188-afb7-4c8e-9111-02483ca7cf43

/// Creates the P&L Lines
function __Fn_PnL_HideVariances =
		(
		    amount: EXPR,
			scenario: EXPR
		) =>
		
		IF(ISFILTERED(Ledger),BLANK(), amount - scenario)
	lineageTag: 4e562496-1344-4327-bdd4-49cbe13a4645

/// Creates the P&L Lines ||| amount = credit less debit amount ||| layoutTable = table containing the P&L layout |||layoutKey = column containing the primary key for the layout table ||| layoutCalculationType = column containing the type of calculation on the line ||| layoutFromColumn = column for subtotals containing the primary key from ||| layoutToColumn = column for subtotals containing the primary key t||| accountIndicator = indicator for "Revenue" (1) or "Expense" (-1) for the account
function 'ChrisBarber.Finance.Profitandloss.basic' =
		(
					    amount: EXPR,
						layoutTable: anyref EXPR,
						layoutKey: anyref EXPR,
						layoutCalculationType: anyref EXPR,
						layoutFromColumn: anyref EXPR,
						layoutToColumn: anyref EXPR,
						accountTable: anyref EXPR,
						accountIndicatorColumn: anyref EXPR
					) =>
					VAR accountinscope = ISFILTERED( accountTable )
					VAR NCLD_filter_context_calculated_table =
					    CALCULATETABLE(
					        layoutTable,
					        REMOVEFILTERS( layoutTable ),
					        layoutKey >= MIN( layoutFromColumn ),
					        layoutKey <= MIN( layoutToColumn)
					    )
					VAR step1_lineitem = amount * MAX( accountIndicatorColumn)
					VAR step2_subtotal =
					    CALCULATE( amount * MAX( accountIndicatorColumn ), NCLD_filter_context_calculated_table )
					VAR step3_addblanks = SWITCH(
					        TRUE( ),
					        accountinscope, BLANK( ),
					        SELECTEDVALUE( layoutCalculationType ) = "Blank", 0
					    )
					VAR step3_add_zero = COALESCE( step1_lineitem, step2_subtotal, step3_addblanks )
					RETURN
					    step3_add_zero
	lineageTag: 8c1bcdd5-6bd5-44b2-bef8-1af20f92de55

